var $=Object.defineProperty,A=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var L=(n,t,e)=>t in n?$(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,x=(n,t)=>{for(var e in t||(t={}))N.call(t,e)&&L(n,e,t[e]);if(b)for(var e of b(t))q.call(t,e)&&L(n,e,t[e]);return n},S=(n,t)=>A(n,G(t));import{j as I,r as o,d,o as C,M as z,m as F,S as H,L as P,G as B,R as K,a as D}from"./vendor.3f00f9ca.js";const J=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}};J();const a=I.exports.jsx,p=I.exports.jsxs,W=()=>{const[n,t]=o.exports.useState(!1);o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]);const e=o.exports.useCallback(()=>{(async()=>(await d.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),t(d.exports.isLoggedIn()),window.location.reload()))()},[]),i=o.exports.useCallback(()=>{(async()=>(d.exports.logout(),t(!1)))()},[]);return a("div",{children:n?a("button",{onClick:i,children:"logout"}):a("button",{onClick:e,children:"login"})})};const T=()=>{const[n,t]=o.exports.useState(!1),[e,i]=o.exports.useState(void 0);return o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]),o.exports.useEffect(()=>{!n||(async()=>{const s=await d.exports.getUser("me");i(s)})()},[n]),a("div",{children:e?a("img",{src:e.img.href,alt:e.display_name,title:e.display_name}):a("img",{})})},V=()=>{const[n,t]=o.exports.useState(!1),[e,i]=o.exports.useState(void 0);return o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]),o.exports.useEffect(()=>{!n||(async()=>{const s=await d.exports.getUser("me");i(s)})()},[n]),p("div",{style:{zIndex:100,position:"relative",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.8)"},children:[p("div",{children:[a("h1",{style:{display:"inline",margin:"0px"},children:"OSM address editor"}),e?p("span",{style:{marginLeft:"10px"},children:["Hi ",e==null?void 0:e.display_name,", You have"," ",e==null?void 0:e.changesets.count," changesets."]}):a("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),p("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[a(T,{}),a(W,{})]})]})},X=()=>({fetchOverpass:o.exports.useCallback(async(t,e)=>{console.log("overpass: loading...");let i="[out:json]";i+=`[timeout:25];
`,i+='nwr["building"="yes"]',i+=`(around:${150},${t},${e});
`,i+="out meta geom;",console.log(i);const r=await(await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(i)}`,{})).json();console.log(r),console.log("overpass: ",r.elements.length);for(const u of r.elements)console.log(u.user,u.uid);return console.log("overpass: ",C(r)),C(r)},[])}),Y={id:"buildings-layer",type:"fill",source:"buildings-source",paint:{"fill-color":"pink","fill-opacity":.4},filter:["==","$type","Polygon"]};function Q(){const[n,t]=o.exports.useState({}),e=o.exports.useRef(null),[i,s]=o.exports.useState({type:"FeatureCollection",features:[]}),[r,u]=o.exports.useState("auto"),[g,y]=o.exports.useState(),[m,h]=o.exports.useState(!1),{fetchOverpass:v}=X();o.exports.useEffect(()=>{setTimeout(()=>{var l;console.log(window.location.hash),window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(l=e.current)==null||l.trigger())},1e3)},[]);const k=o.exports.useCallback(l=>{t(l.viewState)},[]),M=o.exports.useCallback(l=>{t(l.viewState);const c=l.viewState;(async()=>{if(!m){h(!0);const f=await v(c.latitude,c.longitude);s(f),h(!1)}})()},[]),j=o.exports.useCallback(l=>{const c=l.target.getCenter();(async()=>{if(!m){h(!0);const f=await v(c.lat,c.lng);s(f),h(!1)}})()},[]),O=o.exports.useCallback(()=>u("pointer"),[]),E=o.exports.useCallback(()=>u("auto"),[]),R=o.exports.useCallback(l=>{const{features:c,point:{x:f,y:_}}=l,w=c&&c[0];y(w?{feature:w,x:f,y:_}:void 0)},[]),U=o.exports.useCallback(l=>{const c=l.features&&l.features[0];console.log(c)},[]);return console.log(g),p("div",{children:[a(V,{}),a("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw"},children:p(z,S(x({},n),{onMove:k,onMoveEnd:M,onLoad:j,interactiveLayerIds:["buildings-layer"],onClick:U,onMouseEnter:O,onMouseLeave:E,onMouseMove:R,cursor:r,mapLib:F,hash:!0,style:{width:"100%",height:"100%"},mapStyle:"https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json",children:[a(H,{id:"buildings-source",type:"geojson",data:i,children:a(P,x({},Y))}),g&&a("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:g.x,top:g.y},children:a("pre",{children:JSON.stringify(g.feature.properties,null,2)})}),a(B,{ref:e,showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!0,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17},position:"bottom-right"})]}))})]})}K.render(a(D.StrictMode,{children:a(Q,{})}),document.getElementById("root"));
