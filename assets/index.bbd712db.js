var P=Object.defineProperty,K=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var E=(i,s,t)=>s in i?P(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t,I=(i,s)=>{for(var t in s||(s={}))T.call(s,t)&&E(i,t,s[t]);if(j)for(var t of j(s))J.call(s,t)&&E(i,t,s[t]);return i},O=(i,s)=>K(i,B(s));import{j as _,r as e,d,o as W,p as X,c as V,M as Y,t as Z,a as Q,m as ee,F as U,f as te,b as oe,S as se,L as ne,G as re,R as ie,e as ae}from"./vendor.f13fab3e.js";const le=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}};le();const n=_.exports.jsx,y=_.exports.jsxs,ce=()=>{const[i,s]=e.exports.useState(!1);e.exports.useEffect(()=>{s(d.exports.isLoggedIn())},[]);const t=e.exports.useCallback(()=>{(async()=>(await d.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),s(d.exports.isLoggedIn()),window.location.reload()))()},[]),a=e.exports.useCallback(()=>{(async()=>(d.exports.logout(),s(!1)))()},[]);return n("div",{children:i?n("button",{onClick:a,children:"logout"}):n("button",{onClick:t,children:"login"})})};const pe=()=>{const[i,s]=e.exports.useState(!1),[t,a]=e.exports.useState(void 0);return e.exports.useEffect(()=>{s(d.exports.isLoggedIn())},[]),e.exports.useEffect(()=>{!i||(async()=>{const r=await d.exports.getUser("me");a(r)})()},[i]),n("div",{children:t?n("img",{src:t.img.href,alt:t.display_name,title:t.display_name}):n("img",{})})},ue=()=>{const[i,s]=e.exports.useState(!1),[t,a]=e.exports.useState(void 0);return e.exports.useEffect(()=>{s(d.exports.isLoggedIn())},[]),e.exports.useEffect(()=>{!i||(async()=>{const r=await d.exports.getUser("me");a(r)})()},[i]),y("div",{style:{zIndex:100,position:"relative",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.8)"},children:[y("div",{children:[n("h1",{style:{display:"inline",margin:"0px"},children:"OSM address editor"}),t?y("span",{style:{marginLeft:"10px"},children:["Hi ",t==null?void 0:t.display_name,", You have"," ",t==null?void 0:t.changesets.count," changesets."]}):n("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),y("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[n(pe,{}),n(ce,{})]})]})},de=()=>({fetchOverpass:e.exports.useCallback(async(s,t)=>{var m;console.log("overpass: loading...");let a="[out:json]";a+=`[timeout:25];
`,a+='way["building"="yes"]',a+=`(around:${300},${s},${t});
`,a+="out meta geom;",console.log(a);const l=await(await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(a)}`,{})).json();console.log(l),console.log("overpass: ",l.elements.length);const u=W(l);console.log("overpass geojson raw: ",u);for await(const c of u.features){if(c.properties||(c.properties={}),c.geometry.type==="Polygon"){const f=X(c.geometry.coordinates);var h=V(f);c.properties.center=h.geometry.coordinates}const g=c.properties.uid;if(g){let f=localStorage.getItem(g+"-icon");if(f===null){const v=await d.exports.getUser(g);((m=v.img)==null?void 0:m.href)?(f=v.img.href,localStorage.setItem(g+"-icon",v.img.href)):localStorage.setItem(g+"-icon","")}c.properties.userIconHref=f||""}}return console.log("overpass geojson converted: ",u),console.log("overpass: loaded."),u},[])}),ge={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":"pink","fill-opacity":.4},filter:["==","$type","Polygon"]};function fe(){const[i,s]=e.exports.useState({}),t=e.exports.useRef(null),[a,r]=e.exports.useState({type:"FeatureCollection",features:[]}),[l,u]=e.exports.useState("auto"),[h,m]=e.exports.useState(),[c,g]=e.exports.useState(!1),[f,v]=e.exports.useState(),[C,L]=e.exports.useState(),[S,w]=e.exports.useState(),{fetchOverpass:M}=de();e.exports.useEffect(()=>{setTimeout(()=>{var o;console.log(window.location.hash),window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(o=t.current)==null||o.trigger())},500)},[]);const H=e.exports.useCallback(async o=>{if(!S){const p=o.target.getCenter();w(!0);const x=await M(p.lat,p.lng);r(x),w(!1)}},[]),R=e.exports.useCallback(o=>{s(o.viewState)},[]),A=e.exports.useCallback(async o=>{s(o.viewState);const p=o.viewState;if(!S){w(!0);const x=await M(p.latitude,p.longitude);r(x),w(!1)}},[]),z=e.exports.useCallback(o=>{u("pointer");const{features:p,point:{x,y:b}}=o,k=p&&p[0];m(k?{feature:k,x,y:b}:void 0)},[]),F=e.exports.useCallback(()=>{u("auto"),m(void 0)},[]),$=e.exports.useCallback(o=>{console.log("onMouseDown",o.point),!!o.originalEvent.shiftKey&&o.originalEvent.button===0&&(g(!0),v(o.point))},[]),D=e.exports.useCallback(o=>{!c||L(o.point)},[c]),N=e.exports.useCallback(o=>{console.log("onMouseUp",o.point),L(o.point),g(!1)},[]),G=e.exports.useCallback(o=>{var b;const p=o.features&&o.features[0];if(!p)return;const x="https://www.openstreetmap.org/"+p.properties.id;(b=window.open(x,"_blank"))==null||b.focus()},[]);e.exports.useEffect(()=>{c||console.log("drag select: ",c,f,C)},[c,f,C]);const q=e.exports.useMemo(()=>a.features.map((o,p)=>o.properties?n(Y,{style:{cursor:"pointer"},longitude:o.properties.center[0],latitude:o.properties.center[1],anchor:"bottom",children:o.properties.userIconHref.length>0?n("img",{src:o.properties.userIconHref,style:{width:"30px",height:"30px"}}):n("span",{dangerouslySetInnerHTML:{__html:Z(o.properties.user||"noname",30)}})},`marker-${p}`):null),[a]);return y("div",{children:[n(ue,{}),n("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw",display:"flex"},children:y(Q,O(I({},i),{onMove:R,onMoveEnd:A,onLoad:H,interactiveLayerIds:["buildings-layer-fill"],onClick:G,onMouseEnter:z,onMouseLeave:F,onMouseDown:$,onMouseMove:D,onMouseUp:N,dragRotate:!1,boxZoom:!1,hash:!0,cursor:l,mapLib:ee,style:{width:"100%",height:"100%"},mapStyle:"https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json",children:[n("div",{className:"fa-2xl",style:{zIndex:100,display:"flex",position:"absolute",top:"50%",left:"50%",textAlign:"center",verticalAlign:"middle"},children:S?n(U,{size:"2x",spin:!0,icon:te}):n(U,{size:"2x",icon:oe})}),n(se,{id:"buildings-source",type:"geojson",data:a,children:n(ne,I({},ge))}),q,h&&n("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:h.x+5,top:h.y+5},children:n("pre",{children:JSON.stringify(h.feature.properties,null,2)})}),n(re,{ref:t,position:"top-left",style:{marginTop:"55px"},showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!1,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17}})]}))})]})}ie.render(n(ae.StrictMode,{children:n(fe,{})}),document.getElementById("root"));
