var ee=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var B=(o,e,r)=>e in o?ee(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,L=(o,e)=>{for(var r in e||(e={}))se.call(e,r)&&B(o,r,e[r]);if(J)for(var r of J(e))re.call(e,r)&&B(o,r,e[r]);return o},V=(o,e)=>te(o,oe(e));import{j as T,r as s,d as w,o as ae,p as ne,c as ie,b as le,m as de,F as j,f as W,M as ce,t as pe,a as ue,e as ge,S as fe,L as he,N as me,G as ye,g as be,h as xe,i as ve,R as Se,k as we}from"./vendor.565c861b.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&u(p)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};ke();const t=T.exports.jsx,g=T.exports.jsxs,O=T.exports.Fragment,K=()=>{const[o,e]=s.exports.useState(!1);s.exports.useEffect(()=>{e(w.exports.isLoggedIn())},[]);const r=s.exports.useCallback(()=>{(async()=>(await w.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),e(w.exports.isLoggedIn()),window.location.reload()))()},[]),u=s.exports.useCallback(()=>{(async()=>(w.exports.logout(),e(!1)))()},[]);return t(O,{children:o?t("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:u,children:"logout"}):t("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:r,children:"login"})})},Ne=()=>{const[o,e]=s.exports.useState(!1),[r,u]=s.exports.useState(void 0);return s.exports.useEffect(()=>{e(w.exports.isLoggedIn())},[]),s.exports.useEffect(()=>{!o||(async()=>{const n=await w.exports.getUser("me");u(n)})()},[o]),t(O,{children:r?t("img",{style:{width:"44px",height:"44px"},src:r.img.href,alt:r.display_name,title:r.display_name}):t("img",{})})},Ce=()=>{const[o,e]=s.exports.useState(!1),[r,u]=s.exports.useState(void 0);return s.exports.useEffect(()=>{e(w.exports.isLoggedIn())},[]),s.exports.useEffect(()=>{!o||(async()=>{const n=await w.exports.getUser("me");u(n)})()},[o]),g("div",{style:{zIndex:100,position:"relative",top:0,left:0,height:"44px",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.9)"},children:[g("div",{children:[t("h1",{className:"text-4xl font-bold",style:{display:"inline",margin:"0px"},children:"OSM address editor"}),r?g("span",{style:{marginLeft:"10px"},children:["Hi ",r==null?void 0:r.display_name,", You have"," ",r==null?void 0:r.changesets.count," changesets."]}):t("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),g("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[t("div",{children:t(Ne,{})}),t("div",{children:t(K,{})})]})]})},P={type:"FeatureCollection",features:[]},Fe=()=>{const[o,e]=s.exports.useState(!1);return{fetchOverpass:s.exports.useCallback(async(u,n,i)=>{var N,E;if(console.log(i),i<16)return P;let p=300;if(i>17&&(p=200),i>18&&(p=100),i>19&&(p=50),o)return P;e(!0),console.log("overpass: loading...");let f="[out:json]";f+=`[timeout:25];
`,f+='way["building"]',f+=`(around:${p},${u},${n});
`,f+="out meta geom;",console.log(f);const m=await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(f)}`,{});if(m.status!==200)return e(!1),P;const b=await m.json();console.log("overpass json elements: ",b.elements);const x=ae(b);console.log("overpass osmtogeojson raw: ",x);for await(const d of x.features){if(!d.properties)continue;d.id=d.properties.id.split("/")[1];const C=(N=b.elements.filter(y=>d.id?typeof d.id=="number"?y.id===d.id:y.id===parseInt(d.id):!1))==null?void 0:N[0];if(C&&(d.properties.tags=C.tags,d.properties.nodes=C.nodes),d.geometry.type==="Polygon"){const y=ne(d.geometry.coordinates);var I=ie(y);d.properties.center=I.geometry.coordinates}const k=d.properties.uid;if(k){let y=localStorage.getItem(k+"-icon");if(y===null){const F=await w.exports.getUser(k);((E=F.img)==null?void 0:E.href)?(y=F.img.href,localStorage.setItem(k+"-icon",F.img.href)):localStorage.setItem(k+"-icon","")}d.properties.userIconHref=y||""}}return console.log("overpass osmtogeojson converted: ",x),console.log("overpass: loaded."),e(!1),x},[]),loadingOverpass:o}},X=({feature:o})=>{var r;const e=JSON.parse((r=o.properties)==null?void 0:r.center);return g(O,{children:[g("span",{className:"longitude",children:["Longitude: ",Math.round(e[0]*1e4)/1e4]}),", ",g("span",{className:"latitude",children:["Latitude: ",Math.round(e[1]*1e4)/1e4," "]})]})},Y=({feature:o})=>t(O,{children:o.properties&&Object.keys(o.properties).map(e=>{var r;if(e.startsWith("addr"))return g("span",{className:e,children:[(r=o.properties)==null?void 0:r[e]," "]})})}),$={JPN:{postcodeField:{key:"addr:postcode",displayName:"\u90F5\u4FBF\u756A\u53F7",placeholder:"101-0021"},mainFields:[{key:"addr:province",displayName:"\u90FD\u9053\u5E9C\u770C",placeholder:"\u6771\u4EAC\u90FD"},{key:"addr:city",displayName:"\u5E02\u533A\u753A\u6751",placeholder:"\u5343\u4EE3\u7530\u533A"},{key:"addr:quarter",displayName:"\u5730\u540D",placeholder:"\u5916\u795E\u7530"}],detailFields:[{key:"addr:neighbourhood",displayName:"\u4E01\u76EE",placeholder:"1\u4E01\u76EE"},{key:"addr:block_number",displayName:"\u756A\u5730",placeholder:"17"},{key:"addr:housenumber",displayName:"\u53F7",placeholder:"6",prefix:"-"}]},CHN:{postcodeField:{key:"addr:postcode",displayName:"Postcode",placeholder:""},mainFields:[{key:"addr:province",displayName:"Province/Municipality/AR/SAR",placeholder:""},{key:"addr:city",displayName:"City/Prefecture/League",placeholder:""},{key:"addr:district",displayName:"District/County/Banner",placeholder:""}],detailFields:[{key:"addr:street",displayName:"Street",placeholder:""},{key:"addr:housenumber",displayName:"House number",placeholder:""}]}},Ie=()=>{const[o,e]=s.exports.useState(!1);return{detectCountry:s.exports.useCallback(async(u,n)=>{e(!0);const p=await(await fetch("https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_10m_admin_0_countries.geojson")).json();for(const f of p.features)if(le([u,n],f.geometry))return console.log("country: ",f.properties),e(!1),f;e(!1)},[]),loadingCountry:o}},D=({feature:o,fieldName:e,label:r,placeholder:u})=>{var f;const[n,i]=s.exports.useState((f=o.properties)==null?void 0:f[e]);s.exports.useEffect(()=>{var m;i((m=o.properties)==null?void 0:m[e])},[o]);const p=s.exports.useCallback(m=>{i(m.currentTarget.value)},[]);return g("div",{className:"w-full md:w-1/6 py-1 px-2 mb-6 md:mb-0",children:[t("label",{className:"block tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:e,children:r||e}),t("input",{className:"appearance-none block w-full leading-tight rounded py-2 px-1 border border-gray-300 bg-gray-100 text-black placeholder-gray-500 placeholder-opacity-50 focus:outline-none focus:bg-white focus:border-gray-500",id:e,name:e,type:"text",placeholder:u,value:n,onChange:p})]})},Ee={attribution:"https://yuiseki.github.io/osm-address-editor-vite/",host:"https://yuiseki.github.io/osm-address-editor-vite/",created_by:"osm-address-editor-vite",locale:navigator.language,comment:"Update address"},Le=({feature:o,onCancel:e,onSubmit:r})=>{var _,a,c,h;const{detectCountry:u,loadingCountry:n}=Ie(),i=JSON.parse((_=o.properties)==null?void 0:_.center),[p,f]=s.exports.useState(void 0),[m,b]=s.exports.useState(),[x,I]=s.exports.useState(),[N,E]=s.exports.useState(),[d,C]=s.exports.useState(o),[k,y]=s.exports.useState(!1),[F,M]=s.exports.useState(!1);s.exports.useEffect(()=>{y(w.exports.isLoggedIn())},[]),s.exports.useEffect(()=>{(async()=>{var v;const l=await u(i[0],i[1]);if(f(l),((v=l==null?void 0:l.properties)==null?void 0:v.ISO_A3)&&$[l.properties.ISO_A3]){const S=$[l.properties.ISO_A3];b(S.postcodeField),I(S.mainFields),E(S.detailFields)}})()},[o]),s.exports.useEffect(()=>{console.log(d.properties)},[d]);const R=s.exports.useCallback(async()=>{console.info("openReverseGeocoder",[i[0],i[1]]);const l=await de.openReverseGeocoder([i[0],i[1]]);console.info("openReverseGeocoder",l),C(v=>{const S={properties:L({"addr:province":l.prefecture,"addr:city":l.city},v.properties)};return L(L({},v),S)})},[]),A=s.exports.useCallback(async l=>{var G,H,U;M(!0),l.preventDefault();const v=new FormData(l.currentTarget),S=JSON.parse((G=o.properties)==null?void 0:G.tags);v.forEach((z,Q)=>{typeof z=="string"&&z.length>0&&(S[Q]=z)});const q={type:"way",id:o.id,version:(H=o.properties)==null?void 0:H.version,tags:S,nodes:JSON.parse((U=o.properties)==null?void 0:U.nodes)};console.info(JSON.stringify(q,null,2));const Z={create:[],modify:[q],delete:[]};await w.exports.uploadChangeset(Ee,Z),M(!1),window.alert(`Successfully updated OpenStreetMap!!!
 Wait a minutes to apply to the map...`),r()},[o]);return d.properties?g("div",{children:[g("div",{children:["OSM:"," ",t("a",{className:"underline text-blue-600 hover:text-blue-800 visited:text-purple-600",href:"https://www.openstreetmap.org/"+d.properties.id,target:"_blank",children:d.properties.id})," | ",t(X,{feature:d}),g("span",{children:[" | ","Address:"," ",t("span",{className:"underline",children:t(Y,{feature:d})})]})]}),n?t(j,{icon:W,spin:!0}):t(O,{children:m&&x&&N?g("form",{onSubmit:A,children:[t("div",{className:"flex flex-wrap",children:t(D,{feature:d,fieldName:m.key,label:m.displayName,placeholder:m.placeholder})}),t("div",{className:"flex flex-wrap",children:x.map(l=>t(D,{feature:d,fieldName:l.key,label:l.displayName,placeholder:l.placeholder},l.key))}),t("div",{className:"flex flex-wrap",children:N.map(l=>t(D,{feature:d,fieldName:l.key,label:l.displayName,placeholder:l.placeholder},l.key))}),t("div",{className:"flex flex-wrap",children:g("div",{className:"w-full py-2 px-2 mb-6 md:mb-0",children:[t("button",{type:"button",onClick:e,className:"button rounded mr-4 py-2 px-3  bg-gray-200 text-red-600 hover:text-red-800",children:"Cancel"}),((a=p==null?void 0:p.properties)==null?void 0:a.ISO_A3)==="JPN"&&t("button",{type:"button",onClick:R,className:"button rounded mr-4 py-2 px-3 bg-green-300 text-gray-800 hover:text-white",children:"Load address from coordinates"}),t("button",{disabled:!k||F,className:"button rounded mr-2 py-2 px-3 bg-blue-300 text-gray-800 disabled:bg-blue-100 disabled:text-gray-400 hover:text-white",children:"Submit to OpenStreetMap!"}),!k&&g(O,{children:[t("span",{className:"mr-2 underline text-red-600",children:"Require logged in before you submit data to OpenStreetMap"}),t(K,{})]})]})})]}):t("div",{className:"flex flex-wrap",children:g("div",{className:"w-full mb-6 md:mb-0",children:[g("div",{className:"py-2",children:[g("p",{children:["Sorry, Address editor in this country"," ",(c=p==null?void 0:p.properties)==null?void 0:c.NAME," (ISO code:",(h=p==null?void 0:p.properties)==null?void 0:h.ISO_A3,") does not support yet."]}),t("p",{children:t("a",{href:"https://github.com/yuiseki/osm-address-editor-vite",target:"_blank",className:"underline text-blue-600 hover:text-blue-800 visited:text-purple-600",children:"Pull requests are welcome!"})})]}),t("button",{type:"button",onClick:e,className:"button rounded mr-4 py-2 px-3  bg-gray-200 text-red-600 hover:text-red-800",children:"Cancel"})]})})})]}):null};function Oe(o,e){const[r,u]=s.exports.useState(o);return s.exports.useEffect(()=>{const n=setTimeout(()=>{u(o)},e);return()=>{clearTimeout(n)}},[o,e]),r}const Ae={version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xA9 OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:20}]},Me={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":["case",["boolean",["feature-state","select"],!1],"green",["all",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"blue",["any",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"yellow","red"],"fill-opacity":["case",["boolean",["feature-state","select"],!1],.8,["boolean",["feature-state","hover"],!1],.8,.4]},filter:["==","$type","Polygon"]};function _e(){const o=s.exports.useRef(null),[e,r]=s.exports.useState(),u=Oe(e,1e3),n=s.exports.useRef(null),[i,p]=s.exports.useState({type:"FeatureCollection",features:[]}),[f,m]=s.exports.useState("auto"),[b,x]=s.exports.useState(),[I,N]=s.exports.useState([]),{fetchOverpass:E,loadingOverpass:d}=Fe();s.exports.useEffect(()=>{setTimeout(()=>{var a;console.log(window.location.hash),!!window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(a=n.current)==null||a.trigger())},500)},[]);const C=s.exports.useCallback(a=>{const c=a.target.getCenter(),h=a.target.getZoom();r({zoom:h,latitude:c.lat,longitude:c.lng,bearing:0,pitch:0,padding:{top:0,bottom:0,left:0,right:0}})},[]),k=s.exports.useCallback(a=>{r(a.viewState)},[]),y=s.exports.useCallback(a=>{r(a.viewState)},[]);s.exports.useEffect(()=>{(async()=>{if(!u)return;const a=u,c=await E(a.latitude,a.longitude,a.zoom);p(c)})()},[u]);const F=s.exports.useCallback(a=>{var S;m("pointer");const{features:c,point:{x:h,y:l}}=a,v=c&&c[0];v?((S=o.current)==null||S.setFeatureState({source:"buildings-source",id:v.id},{hover:!0}),x({feature:v,x:h,y:l})):x(void 0)},[]),M=s.exports.useCallback(a=>{var c;m("auto"),(c=o.current)==null||c.querySourceFeatures("buildings-source").map(h=>{var l;(l=o.current)==null||l.setFeatureState({source:"buildings-source",id:h.id},{hover:!1})}),x(void 0)},[]),R=s.exports.useCallback(a=>{var h;A();const c=a.features&&a.features[0];!c||((h=o.current)==null||h.setFeatureState({source:"buildings-source",id:c.id},{select:!0}),N([c]))},[]),A=s.exports.useCallback(()=>{var a;(a=o.current)==null||a.querySourceFeatures("buildings-source").map(c=>{var h;(h=o.current)==null||h.setFeatureState({source:"buildings-source",id:c.id},{select:!1})}),N([])},[]),_=s.exports.useMemo(()=>{let a=20;return e&&(a=e.zoom<18?15:e.zoom<19?20:30),i.features.map((c,h)=>c.properties?t(ce,{style:{cursor:"pointer"},longitude:c.properties.center[0],latitude:c.properties.center[1],anchor:"center",children:c.properties.userIconHref.length>0?t("img",{src:c.properties.userIconHref,style:{width:a+"px",height:a+"px"}}):t("span",{dangerouslySetInnerHTML:{__html:pe(c.properties.user||"noname",a)}})},`marker-${h}`):null)},[i,e]);return g("div",{children:[t(Ce,{}),g("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[I.length>0&&t("div",{style:{zIndex:200,position:"absolute",top:"44px",left:0,width:"100vw",backgroundColor:"rgba(255, 255, 255, 0.9)"},children:t("div",{style:{padding:"10px"},children:I.map(a=>t(Le,{feature:a,onCancel:A,onSubmit:A},a.id))})}),g(ue,V(L({ref:o},e),{onMove:k,onMoveEnd:y,onLoad:C,interactiveLayerIds:["buildings-layer-fill"],onClick:R,onMouseEnter:F,onMouseLeave:M,dragRotate:!1,boxZoom:!1,hash:!0,cursor:f,mapLib:ge,style:{width:"100%",height:"100%"},mapStyle:Ae,children:[t(fe,{id:"buildings-source",type:"geojson",data:i,children:t(he,L({},Me))}),t(me,{position:"top-left",style:{marginTop:"55px"},showCompass:!1}),t(ye,{ref:n,position:"top-left",showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!1,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17}}),t("div",{className:"fa-2xl",style:{zIndex:100,display:"flex",position:"absolute",top:"50%",left:"50%",textAlign:"center",verticalAlign:"middle"},children:!e||(e==null?void 0:e.zoom)&&e.zoom<16?t(j,{size:"2x",icon:be}):d?t(j,{size:"2x",icon:W,spin:!0}):t(j,{size:"2x",icon:xe})}),_,b&&g("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:b.x+5,top:b.y+5},children:[t(X,{feature:b.feature}),t("br",{}),t(Y,{feature:b.feature})]})]}))]})]})}window.Buffer=ve.Buffer;Se.render(t(we.StrictMode,{children:t(_e,{})}),document.getElementById("root"));
