var L=Object.defineProperty,S=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var m=(o,t,e)=>t in o?L(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,g=(o,t)=>{for(var e in t||(t={}))C.call(t,e)&&m(o,e,t[e]);if(h)for(var e of h(t))j.call(t,e)&&m(o,e,t[e]);return o},y=(o,t)=>S(o,I(t));import{j as v,r as n,d as c,o as x,M,m as E,S as k,L as O,G as R,R as U,a as _}from"./vendor.d5c8fa93.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}};$();const r=v.exports.jsx,d=v.exports.jsxs,A=()=>{const[o,t]=n.exports.useState(!1);n.exports.useEffect(()=>{t(c.exports.isLoggedIn())},[]);const e=n.exports.useCallback(()=>{(async()=>(await c.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),t(c.exports.isLoggedIn())))()},[]),a=n.exports.useCallback(()=>{(async()=>(c.exports.logout(),t(!1)))()},[]);return r("div",{children:o?r("button",{onClick:a,children:"logout"}):r("button",{onClick:e,children:"login"})})};const q=()=>{const[o,t]=n.exports.useState(!1),[e,a]=n.exports.useState(void 0);return n.exports.useEffect(()=>{t(c.exports.isLoggedIn())},[]),n.exports.useEffect(()=>{!o||(async()=>{const s=await c.exports.getUser("me");a(s)})()},[o]),r("div",{children:e?r("img",{src:e.img.href,alt:e.display_name,title:e.display_name}):r("img",{})})},z=()=>{const[o,t]=n.exports.useState(!1),[e,a]=n.exports.useState(void 0);return n.exports.useEffect(()=>{t(c.exports.isLoggedIn())},[]),n.exports.useEffect(()=>{!o||(async()=>{const s=await c.exports.getUser("me");a(s)})()},[o]),d("div",{style:{zIndex:100,position:"relative",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.8)"},children:[d("div",{children:[r("h1",{style:{display:"inline",margin:"0px"},children:"OSM address editor"}),e?d("span",{style:{marginLeft:"10px"},children:["Hi ",e==null?void 0:e.display_name,", You have"," ",e==null?void 0:e.changesets.count," changesets."]}):r("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),d("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[r(q,{}),r(A,{})]})]})},G={id:"park-boundary",type:"fill",source:"national-park",paint:{"fill-color":"pink","fill-opacity":.4},filter:["==","$type","Polygon"]};function H(){const[o,t]=n.exports.useState({}),e=n.exports.useRef(null),[a,s]=n.exports.useState({type:"FeatureCollection",features:[]});n.exports.useEffect(()=>{setTimeout(()=>{var l;console.log(window.location.hash),window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(l=e.current)==null||l.trigger())},1e3)},[]);const i=n.exports.useCallback(l=>{const f=l.target.getCenter();(async()=>{console.log("overpass: loading...");const b=`[out:json][timeout:25];way["building"="yes"](around:${150},${f.lat},${f.lng});out meta geom;`,u=await(await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(b)}`,{})).json();console.log(u),console.log("overpass: ",u.elements),console.log("overpass: ",x(u)),s(x(u))})()},[o]),p=n.exports.useCallback(l=>{t(l.viewState)},[]),w=n.exports.useCallback(l=>{t(l.viewState)},[]);return d("div",{children:[r(z,{}),r("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw"},children:d(M,y(g({},o),{onIdle:i,onMove:p,onMoveEnd:w,mapLib:E,hash:!0,style:{width:"100%",height:"100%"},mapStyle:"https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json",children:[r(k,{id:"my-data",type:"geojson",data:a,children:r(O,g({},G))}),r(R,{ref:e,showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!0,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17},position:"bottom-right"})]}))})]})}U.render(r(_.StrictMode,{children:r(H,{})}),document.getElementById("root"));
