var B=Object.defineProperty,T=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var O=(n,s,o)=>s in n?B(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o,I=(n,s)=>{for(var o in s||(s={}))W.call(s,o)&&O(n,o,s[o]);if(E)for(var o of E(s))X.call(s,o)&&O(n,o,s[o]);return n},F=(n,s)=>T(n,J(s));import{j as U,r as e,d as f,o as V,p as Y,c as Z,M as Q,t as ee,a as te,m as oe,F as R,f as se,b as re,S as ne,L as ae,G as ie,R as le,e as ce}from"./vendor.f13fab3e.js";const ue=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}};ue();const r=U.exports.jsx,y=U.exports.jsxs,pe=()=>{const[n,s]=e.exports.useState(!1);e.exports.useEffect(()=>{s(f.exports.isLoggedIn())},[]);const o=e.exports.useCallback(()=>{(async()=>(await f.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),s(f.exports.isLoggedIn()),window.location.reload()))()},[]),i=e.exports.useCallback(()=>{(async()=>(f.exports.logout(),s(!1)))()},[]);return r("div",{children:n?r("button",{onClick:i,children:"logout"}):r("button",{onClick:o,children:"login"})})};const de=()=>{const[n,s]=e.exports.useState(!1),[o,i]=e.exports.useState(void 0);return e.exports.useEffect(()=>{s(f.exports.isLoggedIn())},[]),e.exports.useEffect(()=>{!n||(async()=>{const a=await f.exports.getUser("me");i(a)})()},[n]),r("div",{children:o?r("img",{src:o.img.href,alt:o.display_name,title:o.display_name}):r("img",{})})},ge=()=>{const[n,s]=e.exports.useState(!1),[o,i]=e.exports.useState(void 0);return e.exports.useEffect(()=>{s(f.exports.isLoggedIn())},[]),e.exports.useEffect(()=>{!n||(async()=>{const a=await f.exports.getUser("me");i(a)})()},[n]),y("div",{style:{zIndex:100,position:"relative",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.8)"},children:[y("div",{children:[r("h1",{style:{display:"inline",margin:"0px"},children:"OSM address editor"}),o?y("span",{style:{marginLeft:"10px"},children:["Hi ",o==null?void 0:o.display_name,", You have"," ",o==null?void 0:o.changesets.count," changesets."]}):r("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),y("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[r(de,{}),r(pe,{})]})]})},fe=()=>({fetchOverpass:e.exports.useCallback(async(s,o)=>{var x;console.log("overpass: loading...");let i="[out:json]";i+=`[timeout:25];
`,i+='way["building"="yes"]',i+=`(around:${300},${s},${o});
`,i+="out meta geom;",console.log(i);const l=await(await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(i)}`,{})).json();console.log(l),console.log("overpass: ",l.elements.length);const g=V(l);console.log("overpass geojson raw: ",g);for await(const u of g.features){if(!u.properties)continue;if(u.id=u.properties.id.split("/")[1],u.geometry.type==="Polygon"){const h=Y(u.geometry.coordinates);var v=Z(h);u.properties.center=v.geometry.coordinates}const p=u.properties.uid;if(p){let h=localStorage.getItem(p+"-icon");if(h===null){const m=await f.exports.getUser(p);((x=m.img)==null?void 0:x.href)?(h=m.img.href,localStorage.setItem(p+"-icon",m.img.href)):localStorage.setItem(p+"-icon","")}u.properties.userIconHref=h||""}}return console.log("overpass geojson converted: ",g),console.log("overpass: loaded."),g},[])}),he={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":["case",["boolean",["feature-state","select"],!1],"green",["boolean",["has","addr:province"],!1],"blue","pink"],"fill-opacity":["case",["boolean",["feature-state","select"],!1],.8,["boolean",["feature-state","hover"],!1],.8,.4]},filter:["==","$type","Polygon"]};function xe(){const n=e.exports.useRef(null),[s,o]=e.exports.useState({}),i=e.exports.useRef(null),[a,l]=e.exports.useState({type:"FeatureCollection",features:[]}),[g,v]=e.exports.useState("auto"),[x,u]=e.exports.useState(),[p,h]=e.exports.useState(!1),[m,H]=e.exports.useState(),[C,L]=e.exports.useState(),[M,b]=e.exports.useState(),{fetchOverpass:k}=fe();e.exports.useEffect(()=>{setTimeout(()=>{var t;console.log(window.location.hash),window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(t=i.current)==null||t.trigger())},500)},[]);const _=e.exports.useCallback(async t=>{const c=t.target.getCenter();b(!0);const d=await k(c.lat,c.lng);l(d),b(!1)},[]),A=e.exports.useCallback(t=>{o(t.viewState)},[]),z=e.exports.useCallback(async t=>{o(t.viewState);const c=t.viewState;if(!M){b(!0);const d=await k(c.latitude,c.longitude);l(d),b(!1)}},[]),$=e.exports.useCallback(t=>{var j;v("pointer");const{features:c,point:{x:d,y:w}}=t,S=c&&c[0];S?((j=n.current)==null||j.setFeatureState({source:"buildings-source",id:S.id},{hover:!0}),u({feature:S,x:d,y:w})):u(void 0)},[]),D=e.exports.useCallback(t=>{var w;v("auto");const{features:c}=t,d=c&&c[0];d&&((w=n.current)==null||w.setFeatureState({source:"buildings-source",id:d.id},{hover:!1})),u(void 0)},[]),N=e.exports.useCallback(t=>{console.log("onMouseDown",t.point),!!t.originalEvent.shiftKey&&t.originalEvent.button===0&&(h(!0),H(t.point))},[]),G=e.exports.useCallback(t=>{!p||L(t.point)},[p]),q=e.exports.useCallback(t=>{console.log("onMouseUp",t.point),L(t.point),h(!1)},[]),P=e.exports.useCallback(t=>{var d;const c=t.features&&t.features[0];!c||(d=n.current)==null||d.setFeatureState({source:"buildings-source",id:c.id},{select:!0})},[]);e.exports.useEffect(()=>{p||console.log("drag select: ",p,m,C)},[p,m,C]);const K=e.exports.useMemo(()=>a.features.map((t,c)=>t.properties?r(Q,{style:{cursor:"pointer"},longitude:t.properties.center[0],latitude:t.properties.center[1],anchor:"bottom",children:t.properties.userIconHref.length>0?r("img",{src:t.properties.userIconHref,style:{width:"30px",height:"30px"}}):r("span",{dangerouslySetInnerHTML:{__html:ee(t.properties.user||"noname",30)}})},`marker-${c}`):null),[a]);return y("div",{children:[r(ge,{}),r("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw",display:"flex"},children:y(te,F(I({ref:n},s),{onMove:A,onMoveEnd:z,onLoad:_,interactiveLayerIds:["buildings-layer-fill"],onClick:P,onMouseEnter:$,onMouseLeave:D,onMouseDown:N,onMouseMove:G,onMouseUp:q,dragRotate:!1,boxZoom:!1,hash:!0,cursor:g,mapLib:oe,style:{width:"100%",height:"100%"},mapStyle:"https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json",children:[r("div",{className:"fa-2xl",style:{zIndex:100,display:"flex",position:"absolute",top:"50%",left:"50%",textAlign:"center",verticalAlign:"middle"},children:M?r(R,{size:"2x",spin:!0,icon:se}):r(R,{size:"2x",icon:re})}),r(ne,{id:"buildings-source",type:"geojson",data:a,children:r(ae,I({},he))}),K,x&&r("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:x.x+5,top:x.y+5},children:r("pre",{children:JSON.stringify(x.feature.properties,null,2)})}),r(ie,{ref:i,position:"top-left",style:{marginTop:"55px"},showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!1,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17}})]}))})]})}le.render(r(ce.StrictMode,{children:r(xe,{})}),document.getElementById("root"));
