var $=Object.defineProperty,N=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var L=(n,t,e)=>t in n?$(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,w=(n,t)=>{for(var e in t||(t={}))F.call(t,e)&&L(n,e,t[e]);if(I)for(var e of I(t))G.call(t,e)&&L(n,e,t[e]);return n},C=(n,t)=>N(n,A(t));import{j as M,r as o,d,o as q,p as z,c as P,M as B,t as J,a as K,m as D,S as T,L as k,G as W,R as V,b as X}from"./vendor.ac304dd1.js";const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function e(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=e(s);fetch(s.href,l)}};Y();const r=M.exports.jsx,f=M.exports.jsxs,Q=()=>{const[n,t]=o.exports.useState(!1);o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]);const e=o.exports.useCallback(()=>{(async()=>(await d.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),t(d.exports.isLoggedIn()),window.location.reload()))()},[]),a=o.exports.useCallback(()=>{(async()=>(d.exports.logout(),t(!1)))()},[]);return r("div",{children:n?r("button",{onClick:a,children:"logout"}):r("button",{onClick:e,children:"login"})})};const Z=()=>{const[n,t]=o.exports.useState(!1),[e,a]=o.exports.useState(void 0);return o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]),o.exports.useEffect(()=>{!n||(async()=>{const s=await d.exports.getUser("me");a(s)})()},[n]),r("div",{children:e?r("img",{src:e.img.href,alt:e.display_name,title:e.display_name}):r("img",{})})},ee=()=>{const[n,t]=o.exports.useState(!1),[e,a]=o.exports.useState(void 0);return o.exports.useEffect(()=>{t(d.exports.isLoggedIn())},[]),o.exports.useEffect(()=>{!n||(async()=>{const s=await d.exports.getUser("me");a(s)})()},[n]),f("div",{style:{zIndex:100,position:"relative",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.8)"},children:[f("div",{children:[r("h1",{style:{display:"inline",margin:"0px"},children:"OSM address editor"}),e?f("span",{style:{marginLeft:"10px"},children:["Hi ",e==null?void 0:e.display_name,", You have"," ",e==null?void 0:e.changesets.count," changesets."]}):r("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),f("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[r(Z,{}),r(Q,{})]})]})},te=()=>({fetchOverpass:o.exports.useCallback(async(t,e)=>{var y;console.log("overpass: loading...");let a="[out:json]";a+=`[timeout:25];
`,a+='nwr["building"="yes"]',a+=`(around:${200},${t},${e});
`,a+="out meta geom;",console.log(a);const l=await(await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(a)}`,{})).json();console.log(l),console.log("overpass: ",l.elements.length);const p=q(l);for await(const u of p.features){u.properties||(u.properties={});const m=z(u.geometry.coordinates);var h=P(m);u.properties.center=h.geometry.coordinates,u.properties.user;const g=u.properties.uid;if(g){let x=localStorage.getItem(g+"-icon");if(x===null){const v=await d.exports.getUser(g);((y=v.img)==null?void 0:y.href)?(x=v.img.href,localStorage.setItem(g+"-icon",v.img.href)):localStorage.setItem(g+"-icon","")}u.properties.userIconHref=x||""}}return console.log("overpass: ",p),console.log("overpass: loaded."),p},[])}),oe={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":"pink","fill-opacity":.4},filter:["==","$type","Polygon"]},se={id:"buildings-layer-icon",type:"symbol",source:"buildings-source",layout:{"icon-image":["coalesce",["image",["get","userIconHref"]],["image","fallbackImage"]]}};function re(){const[n,t]=o.exports.useState({}),e=o.exports.useRef(null),[a,s]=o.exports.useState({type:"FeatureCollection",features:[]}),[l,p]=o.exports.useState("auto"),[h,y]=o.exports.useState(),[u,m]=o.exports.useState(!1),{fetchOverpass:g}=te();o.exports.useEffect(()=>{setTimeout(()=>{var i;console.log(window.location.hash),window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(i=e.current)==null||i.trigger())},500)},[]);const x=o.exports.useCallback(i=>{const c=i.target.getCenter();(async()=>{if(!u){m(!0);const b=await g(c.lat,c.lng);s(b),m(!1)}})()},[]),v=o.exports.useCallback(i=>{t(i.viewState)},[]),j=o.exports.useCallback(i=>{t(i.viewState);const c=i.viewState;(async()=>{if(!u){m(!0);const b=await g(c.latitude,c.longitude);s(b),m(!1)}})()},[]),O=o.exports.useCallback(()=>p("pointer"),[]),E=o.exports.useCallback(()=>p("auto"),[]),H=o.exports.useCallback(i=>{const{features:c,point:{x:b,y:R}}=i,S=c&&c[0];y(S?{feature:S,x:b,y:R}:void 0)},[]),U=o.exports.useCallback(i=>{const c=i.features&&i.features[0];window.alert(JSON.stringify(c,null,2))},[]),_=o.exports.useMemo(()=>a.features.map((i,c)=>i.properties?r(B,{longitude:i.properties.center[0],latitude:i.properties.center[1],anchor:"bottom",children:i.properties.userIconHref.length>0?r("img",{src:i.properties.userIconHref,style:{width:"30px",height:"30px"}}):r("span",{dangerouslySetInnerHTML:{__html:J(i.properties.user||"noname",30)}})},`marker-${c}`):null),[a]);return f("div",{children:[r(ee,{}),f("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw"},children:[r("div",{style:{position:"absolute",top:"50%",left:"50%",width:"5px",height:"5px",background:"rgba(0, 0, 0, 0.5)"}}),f(K,C(w({},n),{onMove:v,onMoveEnd:j,onLoad:x,interactiveLayerIds:["buildings-layer-fill"],onClick:U,onMouseEnter:O,onMouseLeave:E,onMouseMove:H,cursor:l,mapLib:D,hash:!0,style:{width:"100%",height:"100%"},mapStyle:"https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json",children:[f(T,{id:"buildings-source",type:"geojson",data:a,children:[r(k,w({},oe)),r(k,w({},se))]}),_,h&&r("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:h.x+5,top:h.y+5},children:r("pre",{children:JSON.stringify(h.feature.properties,null,2)})}),r(W,{ref:e,showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!0,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17},position:"bottom-right"})]}))]})]})}V.render(r(X.StrictMode,{children:r(re,{})}),document.getElementById("root"));
