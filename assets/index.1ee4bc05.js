var K=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var G=(t,e,s)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,O=(t,e)=>{for(var s in e||(e={}))Z.call(e,s)&&G(t,s,e[s]);if(q)for(var s of q(e))Q.call(e,s)&&G(t,s,e[s]);return t},H=(t,e)=>X(t,Y(e));import{j as U,r,d as v,o as ee,p as te,c as oe,b as se,m as re,F as R,f as V,t as ne,M as ae,a as ie,e as le,S as de,L as ce,N as pe,G as ue,g as ge,h as fe,i as he,R as me,k as ye}from"./vendor.a68821ac.js";const be=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}};be();const o=U.exports.jsx,u=U.exports.jsxs,C=U.exports.Fragment,B=()=>{const[t,e]=r.exports.useState(!1);r.exports.useEffect(()=>{e(v.exports.isLoggedIn())},[]);const s=r.exports.useCallback(()=>{(async()=>(await v.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),e(v.exports.isLoggedIn()),window.location.reload()))()},[]),l=r.exports.useCallback(()=>{(async()=>(v.exports.logout(),e(!1)))()},[]);return o(C,{children:t?o("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:l,children:"logout"}):o("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:s,children:"login"})})},xe=()=>{const[t,e]=r.exports.useState(!1),[s,l]=r.exports.useState(void 0);return r.exports.useEffect(()=>{e(v.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{!t||(async()=>{const a=await v.exports.getUser("me");l(a)})()},[t]),o(C,{children:s?o("img",{style:{width:"44px",height:"44px"},src:s.img.href,alt:s.display_name,title:s.display_name}):o("img",{})})},ve=()=>{const[t,e]=r.exports.useState(!1),[s,l]=r.exports.useState(void 0);return r.exports.useEffect(()=>{e(v.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{!t||(async()=>{const a=await v.exports.getUser("me");l(a)})()},[t]),u("div",{style:{zIndex:100,position:"relative",top:0,left:0,height:"44px",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.9)"},children:[u("div",{children:[o("h1",{className:"text-4xl font-bold",style:{display:"inline",margin:"0px"},children:"OSM address editor"}),s?u("span",{style:{marginLeft:"10px"},children:["Hi ",s==null?void 0:s.display_name,", You have"," ",s==null?void 0:s.changesets.count," changesets."]}):o("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),u("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[o("div",{children:o(xe,{})}),o("div",{children:o(B,{})})]})]})},P={type:"FeatureCollection",features:[]},Se=()=>{const[t,e]=r.exports.useState(!1);return{fetchOverpass:r.exports.useCallback(async(l,a,i)=>{var w,I;if(console.log(i),i<16)return P;let p=300;if(i>17&&(p=200),i>18&&(p=100),i>19&&(p=50),t)return P;e(!0),console.log("overpass: loading...");let m="[out:json]";m+=`[timeout:25];
`,m+='way["building"]',m+=`(around:${p},${l},${a});
`,m+="out meta geom;",console.log(m);const g=await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(m)}`,{});if(g.status!==200)return e(!1),P;const b=await g.json();console.log("overpass json elements: ",b.elements);const f=ee(b);console.log("overpass osmtogeojson raw: ",f);for await(const h of f.features){if(!h.properties)continue;h.id=h.properties.id.split("/")[1];const k=(w=b.elements.filter(x=>h.id?typeof h.id=="number"?x.id===h.id:x.id===parseInt(h.id):!1))==null?void 0:w[0];if(k&&(h.properties.tags=k.tags,h.properties.nodes=k.nodes),h.geometry.type==="Polygon"){const x=te(h.geometry.coordinates);var F=oe(x);h.properties.center=F.geometry.coordinates}const S=h.properties.uid;if(S){let x=localStorage.getItem(S+"-icon");if(x===null){const N=await v.exports.getUser(S);((I=N.img)==null?void 0:I.href)?(x=N.img.href,localStorage.setItem(S+"-icon",N.img.href)):localStorage.setItem(S+"-icon","")}h.properties.userIconHref=x||""}}return console.log("overpass osmtogeojson converted: ",f),console.log("overpass: loaded."),e(!1),f},[]),loadingOverpass:t}},$=({feature:t})=>{var s;const e=JSON.parse((s=t.properties)==null?void 0:s.center);return u(C,{children:[u("span",{className:"longitude",children:["Longitude: ",Math.round(e[0]*1e4)/1e4]}),", ",u("span",{className:"latitude",children:["Latitude: ",Math.round(e[1]*1e4)/1e4," "]})]})},J={JPN:{postcodeField:{key:"addr:postcode",displayName:"\u90F5\u4FBF\u756A\u53F7",placeholder:"101-0021"},mainFields:[{key:"addr:province",displayName:"\u90FD\u9053\u5E9C\u770C",placeholder:"\u6771\u4EAC\u90FD"},{key:"addr:city",displayName:"\u5E02\u533A\u753A\u6751",placeholder:"\u5343\u4EE3\u7530\u533A"},{key:"addr:quarter",displayName:"\u5730\u540D",placeholder:"\u5916\u795E\u7530"}],detailFields:[{key:"addr:neighbourhood",displayName:"\u4E01\u76EE",placeholder:"1\u4E01\u76EE"},{key:"addr:block_number",displayName:"\u756A\u5730",placeholder:"17"},{key:"addr:housenumber",displayName:"\u53F7",placeholder:"6",prefix:"-"}]},CHN:{postcodeField:{key:"addr:postcode",displayName:"Postcode",placeholder:""},mainFields:[{key:"addr:province",displayName:"Province/Municipality/AR/SAR",placeholder:""},{key:"addr:city",displayName:"City/Prefecture/League",placeholder:""},{key:"addr:district",displayName:"District/County/Banner",placeholder:""}],detailFields:[{key:"addr:street",displayName:"Street",placeholder:""},{key:"addr:housenumber",displayName:"House number",placeholder:""}]}},we=()=>{const[t,e]=r.exports.useState(!1);return{detectCountry:r.exports.useCallback(async(l,a)=>{e(!0);const p=await(await fetch("https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_10m_admin_0_countries.geojson")).json();for(const m of p.features)if(se([l,a],m.geometry))return console.log("country: ",m.properties),e(!1),m;e(!1)},[]),loadingCountry:t}},T=({feature:t,fieldName:e,label:s,placeholder:l})=>{var m;const[a,i]=r.exports.useState((m=t.properties)==null?void 0:m[e]);r.exports.useEffect(()=>{var g;i((g=t.properties)==null?void 0:g[e])},[t]);const p=r.exports.useCallback(g=>{i(g.currentTarget.value)},[]);return u("div",{className:"w-full md:w-1/6 py-1 px-2 mb-6 md:mb-0",children:[o("label",{className:"block tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:e,children:s||e}),o("input",{className:"appearance-none block w-full leading-tight rounded py-2 px-1 border border-gray-300 bg-gray-100 text-black placeholder-gray-500 placeholder-opacity-50 focus:outline-none focus:bg-white focus:border-gray-500",id:e,name:e,type:"text",placeholder:l,value:a,onChange:p})]})},ke=({feature:t,fields:e})=>t.properties?(console.log(t.properties),console.log(e),u(C,{children:[e.postcodeField&&o("span",{children:t.properties[e.postcodeField.key]}),e.mainFields&&e.mainFields.map(s=>{var l;return o("span",{children:(l=t.properties)==null?void 0:l[s.key]})}),e.detailFields&&e.detailFields.map(s=>{var l;return o("span",{children:(l=t.properties)==null?void 0:l[s.key]})})]})):null,Ne={source:"https://yuiseki.github.io/osm-address-editor-vite/",created_by:"osm-address-editor-vite",locale:navigator.language,comment:"Update address"},Ce=({feature:t,onCancel:e,onSubmit:s})=>{var N,_,j,E;const{detectCountry:l,loadingCountry:a}=we(),i=JSON.parse((N=t.properties)==null?void 0:N.center),[p,m]=r.exports.useState(void 0),[g,b]=r.exports.useState(),[f,F]=r.exports.useState(t),[w,I]=r.exports.useState(!1),[h,k]=r.exports.useState(!1);r.exports.useEffect(()=>{I(v.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{(async()=>{var n;const c=await l(i[0],i[1]);if(m(c),((n=c==null?void 0:c.properties)==null?void 0:n.ISO_A3)&&J[c.properties.ISO_A3]){const d=J[c.properties.ISO_A3];b(d)}})()},[t]),r.exports.useEffect(()=>{console.log(f.properties)},[f]);const S=r.exports.useCallback(async()=>{console.info("openReverseGeocoder",[i[0],i[1]]);const c=await re.openReverseGeocoder([i[0],i[1]]);console.info("openReverseGeocoder",c),F(n=>{const d={properties:O({"addr:province":c.prefecture,"addr:city":c.city},n.properties)};return O(O({},n),d)})},[]),x=r.exports.useCallback(async c=>{var A,M,D;k(!0),c.preventDefault();const n=new FormData(c.currentTarget),d=JSON.parse((A=t.properties)==null?void 0:A.tags);n.forEach((z,W)=>{typeof z=="string"&&z.length>0&&(d[W]=z)});const y={type:"way",id:t.id,version:(M=t.properties)==null?void 0:M.version,tags:d,nodes:JSON.parse((D=t.properties)==null?void 0:D.nodes)};console.info(JSON.stringify(y,null,2));const L={create:[],modify:[y],delete:[]};await v.exports.uploadChangeset(Ne,L),k(!1),window.alert(`Successfully updated OpenStreetMap!!!
 Wait a minutes to apply to the map...`),s()},[t]);return f.properties?u("div",{children:[u("div",{children:["OSM:"," ",o("a",{className:"underline text-blue-600 hover:text-blue-800 visited:text-purple-600",href:"https://www.openstreetmap.org/"+f.properties.id,target:"_blank",children:f.properties.id})," | ",o($,{feature:f}),g&&u("span",{children:[" | ","Address:"," ",o(ke,{feature:f,fields:g})]})]}),a?o(R,{icon:V,spin:!0}):o(C,{children:g?u("form",{onSubmit:x,children:[o("div",{className:"flex flex-wrap",children:o(T,{feature:f,fieldName:g.postcodeField.key,label:g.postcodeField.displayName,placeholder:g.postcodeField.placeholder})}),o("div",{className:"flex flex-wrap",children:g.mainFields.map(c=>o(T,{feature:f,fieldName:c.key,label:c.displayName,placeholder:c.placeholder},c.key))}),o("div",{className:"flex flex-wrap",children:g.detailFields.map(c=>o(T,{feature:f,fieldName:c.key,label:c.displayName,placeholder:c.placeholder},c.key))}),o("div",{className:"flex flex-wrap",children:u("div",{className:"w-full py-2 px-2 mb-6 md:mb-0",children:[o("button",{type:"button",onClick:e,className:"button rounded mr-4 py-2 px-3  bg-gray-200 text-red-600 hover:text-red-800",children:"Cancel"}),((_=p==null?void 0:p.properties)==null?void 0:_.ISO_A3)==="JPN"&&o("button",{type:"button",onClick:S,className:"button rounded mr-4 py-2 px-3 bg-green-300 text-gray-800 hover:text-white",children:"Load address from coordinates"}),o("button",{disabled:!w||h,className:"button rounded mr-2 py-2 px-3 bg-blue-300 text-gray-800 disabled:bg-blue-100 disabled:text-gray-400 hover:text-white",children:"Submit to OpenStreetMap!"}),!w&&u(C,{children:[o("span",{className:"mr-2 underline text-red-600",children:"Require logged in before you submit data to OpenStreetMap"}),o(B,{})]})]})})]}):o("div",{className:"flex flex-wrap",children:u("div",{className:"w-full mb-6 md:mb-0",children:[u("div",{className:"py-2",children:[u("p",{children:["Sorry, Address editor in this country"," ",(j=p==null?void 0:p.properties)==null?void 0:j.NAME," (ISO code:",(E=p==null?void 0:p.properties)==null?void 0:E.ISO_A3,") does not support yet."]}),o("p",{children:o("a",{href:"https://github.com/yuiseki/osm-address-editor-vite",target:"_blank",className:"underline text-blue-600 hover:text-blue-800 visited:text-purple-600",children:"Pull requests are welcome!"})})]}),o("button",{type:"button",onClick:e,className:"button rounded mr-4 py-2 px-3  bg-gray-200 text-red-600 hover:text-red-800",children:"Cancel"})]})})})]}):null};function Fe(t,e){const[s,l]=r.exports.useState(t);return r.exports.useEffect(()=>{const a=setTimeout(()=>{l(t)},e);return()=>{clearTimeout(a)}},[t,e]),s}const Ie=({feature:t})=>o(C,{children:t.properties&&Object.keys(t.properties).map(e=>{var s;if(e.startsWith("addr"))return u("div",{className:e,children:[o("span",{className:"underline",children:e})," = ",o("span",{children:(s=t.properties)==null?void 0:s[e]})]})})}),Ee=({feature:t,size:e})=>t.properties===null?null:o(C,{children:t.properties.userIconHref.length>0?o("img",{src:t.properties.userIconHref,style:{width:e+"px",height:e+"px"}}):o("span",{dangerouslySetInnerHTML:{__html:ne(t.properties.user||"noname",e)}})}),Le=({feature:t})=>{var e;return((e=t.properties)==null?void 0:e.uid)?u("span",{children:["Last edited by: ",t.properties.uid]}):null},Ae={version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xA9 OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:20}]},Oe={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":["case",["boolean",["feature-state","select"],!1],"green",["all",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"blue",["any",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"yellow","red"],"fill-opacity":["case",["boolean",["feature-state","select"],!1],.8,["boolean",["feature-state","hover"],!1],.8,.4]},filter:["==","$type","Polygon"]};function Me(){const t=r.exports.useRef(null),[e,s]=r.exports.useState(),l=Fe(e,1e3),a=r.exports.useRef(null),[i,p]=r.exports.useState({type:"FeatureCollection",features:[]}),[m,g]=r.exports.useState("auto"),[b,f]=r.exports.useState(),[F,w]=r.exports.useState([]),{fetchOverpass:I,loadingOverpass:h}=Se();r.exports.useEffect(()=>{setTimeout(()=>{var n;console.log(window.location.hash),!!window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(n=a.current)==null||n.trigger())},500)},[]);const k=r.exports.useCallback(n=>{const d=n.target.getCenter(),y=n.target.getZoom();s({zoom:y,latitude:d.lat,longitude:d.lng,bearing:0,pitch:0,padding:{top:0,bottom:0,left:0,right:0}})},[]),S=r.exports.useCallback(n=>{s(n.viewState)},[]),x=r.exports.useCallback(n=>{s(n.viewState)},[]);r.exports.useEffect(()=>{(async()=>{if(!l)return;const n=l,d=await I(n.latitude,n.longitude,n.zoom);p(d)})()},[l]);const N=r.exports.useCallback(n=>{var M;g("pointer");const{features:d,point:{x:y,y:L}}=n,A=d&&d[0];A?((M=t.current)==null||M.setFeatureState({source:"buildings-source",id:A.id},{hover:!0}),f({feature:A,x:y,y:L})):f(void 0)},[]),_=r.exports.useCallback(n=>{var d;g("auto"),(d=t.current)==null||d.querySourceFeatures("buildings-source").map(y=>{var L;(L=t.current)==null||L.setFeatureState({source:"buildings-source",id:y.id},{hover:!1})}),f(void 0)},[]),j=r.exports.useCallback(n=>{var y;E();const d=n.features&&n.features[0];!d||((y=t.current)==null||y.setFeatureState({source:"buildings-source",id:d.id},{select:!0}),w([d]))},[]),E=r.exports.useCallback(()=>{var n;(n=t.current)==null||n.querySourceFeatures("buildings-source").map(d=>{var y;(y=t.current)==null||y.setFeatureState({source:"buildings-source",id:d.id},{select:!1})}),w([])},[]),c=r.exports.useMemo(()=>{let n=20;return e&&(n=e.zoom<18?15:e.zoom<19?20:30),i.features.map((d,y)=>d.properties?o(ae,{style:{cursor:"pointer"},longitude:d.properties.center[0],latitude:d.properties.center[1],anchor:"center",children:o(Ee,{feature:d,size:n})},`marker-${y}`):null)},[i,e]);return u("div",{children:[o(ve,{}),u("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[F.length>0&&o("div",{style:{zIndex:200,position:"absolute",top:"44px",left:0,width:"100vw",backgroundColor:"rgba(255, 255, 255, 0.9)"},children:o("div",{style:{padding:"10px"},children:F.map(n=>o(Ce,{feature:n,onCancel:E,onSubmit:E},n.id))})}),u(ie,H(O({ref:t},e),{onMove:S,onMoveEnd:x,onLoad:k,interactiveLayerIds:["buildings-layer-fill"],onClick:j,onMouseEnter:N,onMouseLeave:_,dragRotate:!1,boxZoom:!1,hash:!0,cursor:m,mapLib:le,style:{width:"100%",height:"100%"},mapStyle:Ae,children:[o(de,{id:"buildings-source",type:"geojson",data:i,children:o(ce,O({},Oe))}),o(pe,{position:"top-left",style:{marginTop:"55px"},showCompass:!1}),o(ue,{ref:a,position:"top-left",showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!1,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17}}),o("div",{className:"fa-2xl",style:{zIndex:100,display:"flex",position:"absolute",top:"50%",left:"50%",textAlign:"center",verticalAlign:"middle"},children:!e||(e==null?void 0:e.zoom)&&e.zoom<16?o(R,{size:"2x",icon:ge}):h?o(R,{size:"2x",icon:V,spin:!0}):o(R,{size:"2x",icon:fe})}),c,b&&u("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:b.x+5,top:b.y+5},children:[o($,{feature:b.feature}),o("br",{}),o(Le,{feature:b.feature}),o(Ie,{feature:b.feature})]})]}))]})]})}window.Buffer=he.Buffer;me.render(o(ye.StrictMode,{children:o(Me,{})}),document.getElementById("root"));
