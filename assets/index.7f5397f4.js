var X=Object.defineProperty,Z=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var H=(e,o,n)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,E=(e,o)=>{for(var n in o||(o={}))Q.call(o,n)&&H(e,n,o[n]);if(T)for(var n of T(o))ee.call(o,n)&&H(e,n,o[n]);return e},J=(e,o)=>Z(e,Y(o));import{j as z,r,d as x,o as te,p as oe,c as se,m as re,M as ne,t as ae,a as le,b as ie,F as P,f as ce,e as de,S as pe,L as ue,G as ge,g as he,R as fe,h as me}from"./vendor.a6bf9e15.js";const ye=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};ye();const t=z.exports.jsx,u=z.exports.jsxs,L=z.exports.Fragment,B=()=>{const[e,o]=r.exports.useState(!1);r.exports.useEffect(()=>{o(x.exports.isLoggedIn())},[]);const n=r.exports.useCallback(()=>{(async()=>(await x.exports.login({mode:"popup",clientId:"q9sRK4UuNqv3_HLE8E7m2-wUAKS3XJSFWb9apehpAqE",scopes:["read_prefs","write_api","write_notes"],redirectUrl:window.location.href.replace(window.location.hash,"")}),o(x.exports.isLoggedIn()),window.location.reload()))()},[]),a=r.exports.useCallback(()=>{(async()=>(x.exports.logout(),o(!1)))()},[]);return t(L,{children:e?t("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:a,children:"logout"}):t("button",{style:{height:"44px"},className:"button py-1 px-1 border-transparent border-4 bg-gray-300 text-gray-900 hover:text-gray-500",onClick:n,children:"login"})})},be=()=>{const[e,o]=r.exports.useState(!1),[n,a]=r.exports.useState(void 0);return r.exports.useEffect(()=>{o(x.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{!e||(async()=>{const s=await x.exports.getUser("me");a(s)})()},[e]),t(L,{children:n?t("img",{style:{width:"44px",height:"44px"},src:n.img.href,alt:n.display_name,title:n.display_name}):t("img",{})})},xe=()=>{const[e,o]=r.exports.useState(!1),[n,a]=r.exports.useState(void 0);return r.exports.useEffect(()=>{o(x.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{!e||(async()=>{const s=await x.exports.getUser("me");a(s)})()},[e]),u("div",{style:{zIndex:100,position:"relative",top:0,left:0,height:"44px",display:"flex",flexDirection:"row",backgroundColor:"rgba(0, 255, 255, 0.9)"},children:[u("div",{children:[t("h1",{className:"text-4xl font-bold",style:{display:"inline",margin:"0px"},children:"OSM address editor"}),n?u("span",{style:{marginLeft:"10px"},children:["Hi ",n==null?void 0:n.display_name,", You have"," ",n==null?void 0:n.changesets.count," changesets."]}):t("span",{style:{marginLeft:"10px"},children:"Please logged in as OSM user."})]}),u("div",{style:{display:"flex",flex:1,justifyContent:"end"},children:[t("div",{children:t(be,{})}),t("div",{children:t(B,{})})]})]})},V={type:"FeatureCollection",features:[]},ve=()=>{const[e,o]=r.exports.useState(!1);return{fetchOverpass:r.exports.useCallback(async(a,s,i)=>{var k,d;let g=300;if(g=i<18?300:i<19?150:80,e)return V;o(!0),console.log("overpass: loading...");let h="[out:json]";h+=`[timeout:25];
`,h+='way["building"]',h+=`(around:${g},${a},${s});
`,h+="out meta geom;",console.log(h);const f=await fetch(`https://lz4.overpass-api.de/api/interpreter?data=${encodeURIComponent(h)}`,{});if(f.status!==200)return V;const C=await f.json();console.log("overpass json elements: ",C.elements);const w=te(C);console.log("overpass osmtogeojson raw: ",w);for await(const p of w.features){if(!p.properties)continue;p.id=p.properties.id.split("/")[1];const b=(k=C.elements.filter(y=>p.id?typeof p.id=="number"?y.id===p.id:y.id===parseInt(p.id):!1))==null?void 0:k[0];if(b&&(p.properties.tags=b.tags,p.properties.nodes=b.nodes),p.geometry.type==="Polygon"){const y=oe(p.geometry.coordinates);var S=se(y);p.properties.center=S.geometry.coordinates}const v=p.properties.uid;if(v){let y=localStorage.getItem(v+"-icon");if(y===null){const N=await x.exports.getUser(v);((d=N.img)==null?void 0:d.href)?(y=N.img.href,localStorage.setItem(v+"-icon",N.img.href)):localStorage.setItem(v+"-icon","")}p.properties.userIconHref=y||""}}return console.log("overpass osmtogeojson converted: ",w),console.log("overpass: loaded."),o(!1),w},[]),loadingOverpass:e}},$=({feature:e})=>{var n;const o=JSON.parse((n=e.properties)==null?void 0:n.center);return u(L,{children:[u("span",{className:"longitude",children:["Longitude: ",Math.round(o[0]*1e4)/1e4]}),", ",u("span",{className:"latitude",children:["Latitude: ",Math.round(o[1]*1e4)/1e4," "]})]})},F={key:"addr:postcode",displayName:"\u90F5\u4FBF\u756A\u53F7",placeholder:"101-0021"},D=[{key:"addr:province",displayName:"\u90FD\u9053\u5E9C\u770C",placeholder:"\u6771\u4EAC\u90FD"},{key:"addr:city",displayName:"\u5E02\u533A\u753A\u6751",placeholder:"\u5343\u4EE3\u7530\u533A"},{key:"addr:quarter",displayName:"\u5730\u540D",placeholder:"\u5916\u795E\u7530"}],G=[{key:"addr:neighbourhood",displayName:"\u4E01\u76EE",placeholder:"1\u4E01\u76EE"},{key:"addr:block_number",displayName:"\u756A\u5730",placeholder:"17"},{key:"addr:housenumber",displayName:"\u53F7",placeholder:"6",prefix:"-"}];[F.key,...D.map(e=>e.key),...G.map(e=>e.key)];const K=({feature:e})=>{var o,n;return u(L,{children:[((o=e.properties)==null?void 0:o[F.key])&&t("span",{className:"addr:postcode",children:(n=e.properties)==null?void 0:n[F.key]})," ",D.map(a=>{var s,i;return((s=e.properties)==null?void 0:s[a.key])?t("span",{className:a.key,children:(i=e.properties)==null?void 0:i[a.key]},a.key):null})," ",G.map(a=>{var s,i,g;return((s=e.properties)==null?void 0:s[a.key])?u("span",{className:a.key,children:[(i=a.prefix)!=null?i:a.prefix,(g=e.properties)==null?void 0:g[a.key]]},a.key):null})]})},we={attribution:"https://yuiseki.github.io/osm-address-editor-vite/",host:"https://yuiseki.github.io/osm-address-editor-vite/",created_by:"osm-address-editor-vite",locale:navigator.language,comment:"Update address"},U=({feature:e,fieldName:o,label:n,placeholder:a})=>{var h;const[s,i]=r.exports.useState((h=e.properties)==null?void 0:h[o]);r.exports.useEffect(()=>{var f;i((f=e.properties)==null?void 0:f[o])},[e]);const g=r.exports.useCallback(f=>{i(f.currentTarget.value)},[]);return u("div",{className:"w-full md:w-1/6 py-1 px-2 mb-6 md:mb-0",children:[t("label",{className:"block tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:o,children:n||o}),t("input",{className:"appearance-none block w-full leading-tight rounded py-2 px-1 border border-gray-300 bg-gray-100 text-black placeholder-gray-500 placeholder-opacity-50 focus:outline-none focus:bg-white focus:border-gray-500",id:o,name:o,type:"text",placeholder:a,value:s,onChange:g})]})},Se=({feature:e,onCancel:o,onSubmit:n})=>{var k;const a=JSON.parse((k=e.properties)==null?void 0:k.center),[s,i]=r.exports.useState(e),[g,h]=r.exports.useState(!1),[f,C]=r.exports.useState(!1);r.exports.useEffect(()=>{C(x.exports.isLoggedIn())},[]),r.exports.useEffect(()=>{console.log(s.properties)},[s]);const w=r.exports.useCallback(async()=>{console.info("openReverseGeocoder",[a[0],a[1]]);const d=await re.openReverseGeocoder([a[0],a[1]]);console.info("openReverseGeocoder",d),i(p=>{const b={properties:E({"addr:province":d.prefecture,"addr:city":d.city},p.properties)};return E(E({},p),b)})},[]),S=r.exports.useCallback(async d=>{var N,O,A;h(!0),d.preventDefault();const p=new FormData(d.currentTarget),b=JSON.parse((N=e.properties)==null?void 0:N.tags);p.forEach((M,j)=>{typeof M=="string"&&M.length>0&&(b[j]=M)});const v={type:"way",id:e.id,version:(O=e.properties)==null?void 0:O.version,tags:b,nodes:JSON.parse((A=e.properties)==null?void 0:A.nodes)};console.info(JSON.stringify(v,null,2));const y={create:[],modify:[v],delete:[]};await x.exports.uploadChangeset(we,y),h(!1),window.alert(`Successfully updated OpenStreetMap!!!
 Wait a minutes to apply to the map...`),n()},[e]);return t("div",{children:s.properties&&u(L,{children:[u("div",{children:["OSM:"," ",t("a",{className:"underline text-blue-600 hover:text-blue-800 visited:text-purple-600",href:"https://www.openstreetmap.org/"+s.properties.id,target:"_blank",children:s.properties.id})," | ",t($,{feature:s})," | ",u("span",{children:["Address:"," ",t("span",{className:"underline",children:t(K,{feature:s})})]})]}),u("form",{onSubmit:S,children:[u("div",{className:"flex flex-wrap",children:[t(U,{feature:s,fieldName:F.key,label:F.displayName,placeholder:F.placeholder}),D.map(d=>t(U,{feature:s,fieldName:d.key,label:d.displayName,placeholder:d.placeholder},d.key))]}),t("div",{className:"flex flex-wrap",children:G.map(d=>t(U,{feature:s,fieldName:d.key,label:d.displayName,placeholder:d.placeholder},d.key))}),t("div",{className:"flex flex-wrap",children:u("div",{className:"w-full py-2 px-2 mb-6 md:mb-0",children:[t("button",{type:"button",onClick:o,className:"button rounded mr-4 py-2 px-3  bg-gray-200 text-red-600 hover:text-red-800",children:"Cancel"}),t("button",{type:"button",onClick:w,className:"button rounded mr-4 py-2 px-3 bg-green-300 text-gray-800 hover:text-white",children:"Load address from coordinates"}),t("button",{disabled:!f||g,className:"button rounded mr-2 py-2 px-3 bg-blue-300 text-gray-800 disabled:bg-blue-100 disabled:text-gray-400 hover:text-white",children:"Submit to OpenStreetMap!"}),!f&&u(L,{children:[t("span",{className:"mr-2 underline text-red-600",children:"Require logged in before you submit data to OpenStreetMap"}),t(B,{})]})]})})]})]})})};function ke(e,o){const[n,a]=r.exports.useState(e);return r.exports.useEffect(()=>{const s=setTimeout(()=>{a(e)},o);return()=>{clearTimeout(s)}},[e,o]),n}const Ne={id:"buildings-layer-fill",type:"fill",source:"buildings-source",paint:{"fill-color":["case",["boolean",["feature-state","select"],!1],"green",["all",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"blue",["any",["boolean",["has","addr:postcode"],!1],["boolean",["has","addr:province"],!1],["boolean",["has","addr:city"],!1],["boolean",["has","addr:quarter"],!1],["boolean",["has","addr:neighbourhood"],!1],["boolean",["has","addr:block_number"],!1],["boolean",["has","addr:housenumber"],!1]],"yellow","pink"],"fill-opacity":["case",["boolean",["feature-state","select"],!1],.8,["boolean",["feature-state","hover"],!1],.8,.4]},filter:["==","$type","Polygon"]};function Ce(){const e=r.exports.useRef(null),[o,n]=r.exports.useState("https://openmaptiles.github.io/positron-gl-style/style-cdn.json"),[a,s]=r.exports.useState(),i=ke(a,1e3),g=r.exports.useRef(null),[h,f]=r.exports.useState({type:"FeatureCollection",features:[]}),[C,w]=r.exports.useState("auto"),[S,k]=r.exports.useState(),[d,p]=r.exports.useState([]),{fetchOverpass:b,loadingOverpass:v}=ve();r.exports.useEffect(()=>{setTimeout(()=>{var l;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&n("https://raw.githubusercontent.com/geoloniamaps/basic/gh-pages/style.json"),console.log(window.location.hash),!!window.location.hash.endsWith("/0/0")&&(console.log("geolocateControlRef trigger"),(l=g.current)==null||l.trigger())},500)},[]);const y=r.exports.useCallback(async l=>{const c=l.target.getCenter(),m=l.target.getZoom(),I=await b(c.lat,c.lng,m);f(I)},[]),N=r.exports.useCallback(l=>{s(l.viewState)},[]),O=r.exports.useCallback(l=>{s(l.viewState)},[]);r.exports.useEffect(()=>{(async()=>{if(!i)return;const l=i,c=await b(l.latitude,l.longitude,l.zoom);f(c)})()},[i]);const A=r.exports.useCallback(l=>{var q;w("pointer");const{features:c,point:{x:m,y:I}}=l,_=c&&c[0];_?((q=e.current)==null||q.setFeatureState({source:"buildings-source",id:_.id},{hover:!0}),k({feature:_,x:m,y:I})):k(void 0)},[]),M=r.exports.useCallback(l=>{var c;w("auto"),(c=e.current)==null||c.querySourceFeatures("buildings-source").map(m=>{var I;(I=e.current)==null||I.setFeatureState({source:"buildings-source",id:m.id},{hover:!1})}),k(void 0)},[]),j=r.exports.useCallback(l=>{var m;R();const c=l.features&&l.features[0];!c||((m=e.current)==null||m.setFeatureState({source:"buildings-source",id:c.id},{select:!0}),p([c]))},[]),R=r.exports.useCallback(()=>{var l;(l=e.current)==null||l.querySourceFeatures("buildings-source").map(c=>{var m;(m=e.current)==null||m.setFeatureState({source:"buildings-source",id:c.id},{select:!1})}),p([])},[]),W=r.exports.useMemo(()=>{let l=30;return a&&(console.log(a.zoom),l=a.zoom<18?15:30),h.features.map((c,m)=>c.properties?t(ne,{style:{cursor:"pointer"},longitude:c.properties.center[0],latitude:c.properties.center[1],anchor:"center",children:c.properties.userIconHref.length>0?t("img",{src:c.properties.userIconHref,style:{width:l+"px",height:l+"px"}}):t("span",{dangerouslySetInnerHTML:{__html:ae(c.properties.user||"noname",l)}})},`marker-${m}`):null)},[h,a]);return u("div",{children:[t(xe,{}),u("div",{style:{zIndex:1,position:"absolute",top:0,left:0,height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[d.length>0&&t("div",{style:{zIndex:200,position:"absolute",top:"44px",left:0,height:"250px",width:"100vw",backgroundColor:"rgba(255, 255, 255, 0.9)"},children:t("div",{style:{padding:"10px"},children:d.map(l=>t(Se,{feature:l,onCancel:R,onSubmit:R},l.id))})}),u(le,J(E({ref:e},a),{onMove:N,onMoveEnd:O,onLoad:y,interactiveLayerIds:["buildings-layer-fill"],onClick:j,onMouseEnter:A,onMouseLeave:M,dragRotate:!1,boxZoom:!1,hash:!0,cursor:C,mapLib:ie,style:{width:"100%",height:"100%"},mapStyle:o,children:[t("div",{className:"fa-2xl",style:{zIndex:100,display:"flex",position:"absolute",top:"50%",left:"50%",textAlign:"center",verticalAlign:"middle"},children:v?t(P,{size:"2x",spin:!0,icon:ce}):t(P,{size:"2x",icon:de})}),t(pe,{id:"buildings-source",type:"geojson",data:h,children:t(ue,E({},Ne))}),W,S&&u("div",{className:"tooltip",style:{zIndex:10,background:"rgba(255, 255, 255, 0.7)",padding:"5px",width:"250px",position:"absolute",left:S.x+5,top:S.y+5},children:[t($,{feature:S.feature}),t("br",{}),t(K,{feature:S.feature})]}),t(ge,{ref:g,position:"top-left",style:{marginTop:"55px"},showUserLocation:!0,showAccuracyCircle:!1,trackUserLocation:!1,positionOptions:{enableHighAccuracy:!0},fitBoundsOptions:{zoom:17}})]}))]})]})}window.Buffer=he.Buffer;fe.render(t(me.StrictMode,{children:t(Ce,{})}),document.getElementById("root"));
